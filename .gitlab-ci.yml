image: golang:1.14

stages:
  - build
  - test

build:
  tags:
    - iam_ci
  stage: build
  script:
    - go build

test:
  tags:
    - iam_ci
  stage: test
  script:
    - apt update
    - apt install -y libssl-dev  
    - go test $(go list ./... | grep -v "/vendor") -v -coverprofile .testCoverage.txt
    - go tool cover -func=.testCoverage.txt
